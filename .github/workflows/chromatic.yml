name: Chromatic UI Verification

on:
  pull_request_target:
    branches:
      - main # main ë¸Œëœì¹˜ë¡œì˜ PR ë°œìƒ ì‹œ ì‹¤í–‰
    types: [opened, synchronize, reopened] # PRì´ ì—´ë¦¬ê±°ë‚˜, ì—…ë°ì´íŠ¸ë˜ê±°ë‚˜, ë‹¤ì‹œ ì—´ë¦´ ë•Œ ì‹¤í–‰

jobs:
  chromatic-test:
    # ë ˆí¬ì™€ PRìœ ì € ì œí•œ. Dependabotì€ ì˜ì¡´ì„± ì—…ë°ì´íŠ¸ë¥¼ ìë™í™”í•˜ëŠ” GitHubì˜ ë´‡.
    if: github.repository == 'prography/10th-Motimo-FE' &&
      (
      github.event.pull_request.user.login == 'Hys-Lee' ||
      github.event.pull_request.user.login == 'devgony' ||
      startsWith(github.actor, 'dependabot')
      )

    permissions:
      contents: read # ì½”ë“œ ì²´í¬ì•„ì›ƒì— í•„ìš”
      pull-requests: read # PR ì •ë³´ ì½ê¸°ì— í•„ìš” (pull_request_target ì‚¬ìš© ì‹œ)
    runs-on: ubuntu-latest
    steps:
      - name: Checkout PR code
        uses: actions/checkout@v4
        with:
          # PRì˜ ìµœì‹  ì»¤ë°‹ì„ ê°€ì ¸ì˜µë‹ˆë‹¤. PR_targetì˜ ìœ„í—˜ì„±ì„ ë‚®ì¶¥ë‹ˆë‹¤.
          ref: ${{ github.event.pull_request.head.sha }}
          fetch-depth: 0 # Chromaticì´ Git íˆìŠ¤í† ë¦¬ë¥¼ ë¶„ì„í•  ìˆ˜ ìˆë„ë¡ í•¨

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20" # í”„ë¡œì íŠ¸ì— ë§ëŠ” Node.js ë²„ì „

      - name: Install dependencies
        run: npm install # ë˜ëŠ” npm install

      - name: Build Storybook (ì„ íƒ ì‚¬í•­, í•„ìš”ì‹œ)
        run: npm run build-storybook # ë˜ëŠ” npm run build-storybook

      - name: Run Chromatic
        uses: chromaui/action@v1
        with:
          # ğŸ‘‡ Chromatic í”„ë¡œì íŠ¸ í† í° (Secretsì— ì €ì¥ ê¶Œì¥)
          projectToken: ${{ secrets.CHROMATIC_PROJECT_TOKEN }}
          # ğŸ‘‡ trueë¡œ ì„¤ì •í•˜ë©´ ë¦¬ë·°ë˜ì§€ ì•Šì€ ë³€ê²½ì´ ìˆì„ ê²½ìš° CIë¥¼ ì‹¤íŒ¨ì‹œí‚´
          exitZeroOnChanges: false
